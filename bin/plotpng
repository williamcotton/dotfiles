#!/usr/bin/env python3

import sys
import argparse
import matplotlib.pyplot as plt
import io
import csv

# Parse command-line arguments
parser = argparse.ArgumentParser()
parser.add_argument('-d', '--date-column', type=str, required=True, help='Name of the date column')
parser.add_argument('-v', '--value-column', type=str, required=True, help='Name of the value column')
args = parser.parse_args()

# Read tab-separated values from standard input
reader = csv.DictReader(sys.stdin, delimiter='\t')

# Parse data into lists
dates = []
values = []
for row in reader:
    dates.append(row[args.date_column])
    values.append(float(row[args.value_column]))

# Create plot
fig, ax = plt.subplots()
ax.plot(dates, values)

# Save plot to PNG image in memory
buffer = io.BytesIO()
plt.savefig(buffer, format='png')
plt.close(fig)

# Write PNG image to standard output
sys.stdout.buffer.write(buffer.getvalue())
