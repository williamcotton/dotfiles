#!/usr/bin/env python3

import argparse
import csv
import mysql.connector
import sys

# Parse command-line arguments
parser = argparse.ArgumentParser(description="Import a CSV/TSV file into a MySQL database")
parser.add_argument("database", help="the name of the MySQL database to use")
parser.add_argument("table", help="the name of the table to create in the database")
parser.add_argument("--tsv", action="store_true", help="use TSV format instead of CSV")
args = parser.parse_args()

# Connect to the MySQL server
cnx = mysql.connector.connect(host="127.0.0.1", database=args.database)
cursor = cnx.cursor()

# Read the CSV/TSV file from stdin
if args.tsv:
    reader = csv.reader(sys.stdin, delimiter="\t")
else:
    reader = csv.reader(sys.stdin)

# Get the headers from the first row of the file
headers = next(reader)

# Create the table in the database
columns = ", ".join("`{}` VARCHAR(255)".format(header) for header in headers)
create_table_query = "CREATE TABLE `{}` ({})".format(args.table, columns)
cursor.execute(create_table_query)

# Insert the data into the table
for row in reader:
    values = ", ".join("'{}'".format(value) for value in row)
    insert_query = "INSERT INTO `{}` ({}) VALUES ({})".format(args.table, ", ".join("`{}`".format(header) for header in headers), values)
    cursor.execute(insert_query)

# Commit the changes and close the connection
cnx.commit()
cnx.close()