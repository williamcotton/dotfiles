#!/usr/bin/env python

import pika
import sys

connection = pika.BlockingConnection(pika.ConnectionParameters(host="localhost"))
channel = connection.channel()
channel.queue_declare(queue="rpc_queue")


def on_request(ch, method, props, body):
    http_text = body.decode()
    http_text += f"Correlation-ID: {props.correlation_id}\n"
    http_text += f"Reply-To: {props.reply_to}\n"
    http_text += f"Delivery-Tag: {method.delivery_tag}\n"
    sys.stdout.write(http_text)
    sys.stdout.write("\n")
    sys.stdout.flush()


channel.basic_consume(queue="rpc_queue", on_message_callback=on_request, auto_ack=True)
channel.start_consuming()
